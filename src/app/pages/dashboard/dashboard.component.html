<div class="dashboard">
  <div class="page-header">
    <div>
      <h1 class="page-title">Dashboard</h1>
      <p class="page-subtitle">Overview of daily limits and cache performance</p>
    </div>
    <div class="header-actions">
      <button class="btn btn-secondary" (click)="loadData()">Refresh</button>
    </div>
  </div>

  @if (error) {
    <div class="alert alert-error">{{ error }}</div>
  }

  @if (loading) {
    <div class="loading-state">
      <div class="spinner"></div>
      <p>Loading dashboard...</p>
    </div>
  } @else {
    <div class="stats-grid">
      <div class="card stat-card">
        <div class="stat-label">Today's Limit <i class="info-icon" data-tooltip="The maximum transaction amount allocated for today. This is the initial daily limit set in the database.">i</i></div>
        <div class="stat-number">{{ todayLimit?.dailyLimit || 0 }}</div>
        <div class="stat-detail">Consumed: {{ todayLimit?.consumed || 0 }}</div>
      </div>

      <div class="card stat-card">
        <div class="stat-label">Remaining <i class="info-icon" data-tooltip="How much of today's limit is still available. When this reaches zero, further transactions will be rejected.">i</i></div>
        <div class="stat-number">{{ todayLimit?.remaining || 0 }}</div>
        <div class="stat-detail">{{ todayLimit?.utilizationPercent || 0 }}% utilized</div>
      </div>

      <div class="card stat-card">
        <div class="stat-label">Cache Hit Rate <i class="info-icon" data-tooltip="Percentage of requests served from Redis cache instead of hitting the database. Higher is better.">i</i></div>
        <div class="stat-number">{{ cacheStats?.hitRate || 0 }}%</div>
        <div class="stat-detail">{{ cacheStats?.hits || 0 }} hits / {{ cacheStats?.misses || 0 }} misses</div>
      </div>

      <div class="card stat-card">
        <div class="stat-label">Cache Entries <i class="info-icon" data-tooltip="Number of daily limit records currently stored in the Redis cache. Use 'Warm Cache' to preload entries.">i</i></div>
        <div class="stat-number">{{ cacheStats?.size || 0 }}</div>
        <div class="stat-detail">{{ status?.cacheEnabled ? 'Cache active' : 'Cache inactive' }}</div>
      </div>
    </div>

    <div class="card">
      <div class="card-header">
        <div class="card-title"><h3>Quick Actions</h3></div>
      </div>
      <div class="action-buttons">
        <button class="btn btn-primary" (click)="consumeLimit()">Consume Limit <i class="info-icon" data-tooltip="Deducts a random amount from today's limit via the cache path. Simulates a single transaction.">i</i></button>
        <button class="btn btn-secondary" (click)="warmCache()">Warm Cache <i class="info-icon" data-tooltip="Preloads all daily limits for the current month into Redis. Required before running cache-based tests.">i</i></button>
        <button class="btn btn-danger" (click)="clearCache()">Clear Cache <i class="info-icon" data-tooltip="Removes all cached limit data from Redis. Subsequent requests will fall back to the database.">i</i></button>
      </div>
    </div>
  }
</div>
